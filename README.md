# ASPNET Authentication Extensions

This repository contains extensions to the ASPNET authentication mechanism.

## Installing

Add a package reference from NuGet

```
dotnet add package Faactory.Extensions.Authentication
```

## Secret Key

This is a simple authentication process based on secret key. It's useful for communication between microservices where both parties share a common secret.

```csharp
public void ConfigureServices( IServiceCollection services )
{
    ...

    // add your services here.
    services.SecretAuthentication( schemeOptions =>
    {
        schemeOptions.Secret = "secret-value";
        schemeOptions.SecretKeyHeader = "X-Secret-Key"; // optional
    } );
}
```

The `Secret` is the actual value of the shared secret. The `SecretKeyHeader` is the name of the header where to look for the secret value sent by the client. If they match, the authentication succeeds.
If the `SecretKeyHeader` isn't given, the `Authorization` header is used and a `Secret` scheme is expected; for example `Authorization: Secret secret-value`.

## HMAC

This authentication process uses an hashing mechanism to ensure data integrity in addition to the request coming from a trusted client. It's also very useful for communication between microservices.
A secret is shared between both parties communicating and this secret is used to create an hash for the request.

The hash is generated using the following values

```
random_key http_method url [content_hash]
```

The random key is generated by the client and is sent along with the hash. If the request has a body, an MD5 hash is generated for it, to ensure te integrity of the message.

The hash value is encoded as a base64 string and sent in the `Authorization` header along with the random key.

```
Authorization: hmac random_key:hash_base64
```

Upon receiving the request, the service will create a hash and compare it with the one received. If the secret is not the same or the request is tampered with, the hashes won't match.

```csharp
public void ConfigureServices( IServiceCollection services )
{
    ...

    // add your services here.
    services.AddHmacAuthentication( options =>
    {
        options.Secret = ... // secret as a byte[]
    } );
}
```
